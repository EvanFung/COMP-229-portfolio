<% include ../partials/header %>
<div class="container login-container">
    <div class="row">
        <div class="col s12 m12">
            <div class="card">
                <div class="card-content">
                    <span class="card-title">Sign In</span>
                    <div class="row">
                        <form class="col s12" id="loginForm">
                            <div class="row">
                                <div class="input-field col s12">
                                    <input required id="email" type="text" class="validate" name="email">
                                    <label for="email">Email</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input required id="password" type="password" class="validate" name="password">
                                    <label for="password">Password</label>
                                </div>
                            </div>
                            <div class="card-action center">
                                <button id="loginBtn" class='btn btn-login' type="submit">Login</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var loginForm = document.querySelector("#loginForm");
    if (loginForm) {
        loginForm.addEventListener("submit", function (event) {
            submitForm(event, loginForm);
        });
    }

    function submitForm(e, form) {
        e.preventDefault();
        var loginBtn = document.querySelector("#loginBtn");

        var formData = buildJsonFormData(form);

        axios.post('/user/login', {
                user: {
                    email: formData.email,
                    password: formData.password
                }
            })
            .then(function (response) {
                // if (response.data.user) {
                //     window.localStorage.setItem('token', response.data.user.token);
                //     window.localStorage.setItem('user',JSON.stringify(response.data.user));
                //     window.location.href = "/business";
                // }
                window.location.href = "/business";
                
            })
            .catch(function (err) {
                console.log(err);
            });
    }

    function buildJsonFormData(form) {
        var data = {};
        for (var pair of new FormData(form)) {
            data[pair[0]] = pair[1];
        }
        return data;
    }
</script>
<% include ../partials/footer %>